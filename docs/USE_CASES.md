# GMX v2 做市机器人 - Use Cases 用例文档

## 目录
1. [用户画像](#用户画像)
2. [核心用例](#核心用例)
3. [详细场景](#详细场景)
4. [用户旅程](#用户旅程)

---

## 用户画像

### Persona 1: DeFi 新手小白 - 小明
- **年龄**: 25岁
- **背景**: 互联网从业者，持有一些 ETH 和 USDC
- **痛点**: 想要获取被动收益，但不懂复杂的 DeFi 操作
- **目标**: 简单操作就能赚取稳定收益
- **技术水平**: 低

### Persona 2: DeFi 老手 - 阿辉
- **年龄**: 30岁
- **背景**: 全职加密货币投资者
- **痛点**: 需要手动监控多个池子，频繁调仓太累
- **目标**: 自动化管理 LP 仓位，节省时间
- **技术水平**: 高

### Persona 3: 机构投资者 - 陈总
- **年龄**: 40岁
- **背景**: 管理家族资金，追求稳健收益
- **痛点**: 需要严格的风控和完整的报告
- **目标**: 低风险、可追溯的收益来源
- **技术水平**: 中

---

## 核心用例

### UC01: 查看池子排名
**角色**: 所有用户
**前置条件**: 已安装并配置好机器人
**主流程**:
1. 用户打开 Dashboard 或执行 CLI 命令
2. 系统获取所有 GMX v2 池子数据
3. 系统计算每个池子的评分（APY、风险、流动性）
4. 系统按评分排序展示池子列表
5. 用户查看池子详情

**输出**: 池子排名列表，包含 APY、TVL、风险评分等

```
┌──────────────────────────────────────────────────────────────┐
│                    GMX v2 Pool Rankings                       │
├─────────┬────────┬───────────┬────────────┬─────────────────┤
│ Pool    │  APY   │    TVL    │ OI Balance │  Score (0-100)  │
├─────────┼────────┼───────────┼────────────┼─────────────────┤
│ ETH-USDC│ 18.5%  │  $45.2M   │   0.12     │      82.3       │
│ BTC-USDC│ 15.2%  │  $38.7M   │   0.08     │      79.1       │
│ ARB-USDC│ 24.3%  │  $12.1M   │   0.25     │      71.5       │
│ LINK-USD│ 22.1%  │  $8.5M    │   0.31     │      65.2       │
└─────────┴────────┴───────────┴────────────┴─────────────────┘
```

---

### UC02: 一键投资
**角色**: 小白用户
**前置条件**: 钱包中有可用资金
**主流程**:
1. 用户点击"一键投资"按钮
2. 系统询问投资金额
3. 用户输入金额（如 $1000）
4. 系统自动选择最优池子组合
5. 系统展示投资计划预览
6. 用户确认
7. 系统执行交易

**业务规则**:
- 自动分散到 2-5 个池子
- 单池不超过总仓位的 30%
- 优先选择高评分池子

**输出**: 交易执行结果

```
📊 投资计划预览
────────────────────────────────
投资金额: $1,000 USDC

分配方案:
  • ETH-USDC  $400 (40%)  APY: 18.5%
  • BTC-USDC  $350 (35%)  APY: 15.2%
  • ARB-USDC  $250 (25%)  APY: 24.3%

预计年化收益: $183.5 (18.35%)
────────────────────────────────
        [确认投资]  [取消]
```

---

### UC03: 自动再平衡
**角色**: 进阶用户
**前置条件**: 已有持仓，启用了自动再平衡
**触发条件**:
- 定时检查（如每小时）
- 仓位偏离目标超过阈值

**主流程**:
1. 系统定时检查当前持仓
2. 系统计算每个池子的目标占比
3. 系统发现偏差超过 5%
4. 系统生成再平衡方案
5. 系统执行调仓（或通知用户确认）

**示例场景**:
```
⚖️ 再平衡触发
────────────────────────────────
原因: ETH-USDC 占比偏高 (45% > 目标35%)

调整方案:
  • ETH-USDC: -$150 (45% → 35%)
  • ARB-USDC: +$150 (20% → 30%)

预计 Gas: 0.002 ETH (~$6)
────────────────────────────────
```

---

### UC04: 风险监控告警
**角色**: 所有用户
**前置条件**: 启用了告警功能
**触发条件**:
- APY 大幅下降 (>5%)
- 多空严重失衡 (>30%)
- 持仓回撤超限 (>10%)
- 标的价格剧烈波动 (>10%)

**主流程**:
1. 系统检测到风险事件
2. 系统评估严重程度
3. 系统通过 Telegram/Discord 发送告警
4. 用户查看告警详情
5. 用户决定是否干预

**告警示例**:
```
🚨 风险告警 - ARB-USDC 池
────────────────────────────────
时间: 2025-01-15 14:32 UTC
类型: 多空失衡
详情: Long OI 占比达到 72%，超出阈值

当前状态:
  • Long OI: $8.2M
  • Short OI: $3.1M
  • 失衡比: 0.45

建议: 考虑减少该池仓位
────────────────────────────────
        [查看详情]  [暂时忽略]
```

---

### UC05: 紧急退出
**角色**: 所有用户
**前置条件**: 有持仓
**触发条件**:
- 用户手动触发
- 止损线被触发
- 系统检测到异常

**主流程**:
1. 触发紧急退出
2. 系统立即停止所有自动操作
3. 系统评估最优退出顺序
4. 系统执行全部提款
5. 系统通知用户结果

**特殊处理**:
- 优先退出高风险池
- 容忍更高滑点以确保执行
- 失败重试机制

---

### UC06: 收益报告生成
**角色**: 机构用户
**前置条件**: 有历史交易数据
**主流程**:
1. 用户选择报告周期（日/周/月）
2. 系统汇总持仓变化
3. 系统计算收益来源分解
4. 系统生成报告

**报告内容**:
```
📈 月度收益报告 - 2025年1月
════════════════════════════════════════

💰 收益总览
────────────────────────────────
期初资产:     $10,000.00
期末资产:     $10,185.32
净收益:       $185.32 (+1.85%)
年化收益率:   22.2%

📊 收益来源分解
────────────────────────────────
交易费收入:   $120.45  (65%)
借贷费收入:   $42.30   (23%)
交易者亏损:   $35.67   (19%)
Gas 支出:     -$13.10  (-7%)

🏊 池子表现
────────────────────────────────
ETH-USDC:  +$82.15  (+2.1%)  ★★★★★
BTC-USDC:  +$65.20  (+1.9%)  ★★★★☆
ARB-USDC:  +$37.97  (+1.5%)  ★★★☆☆

📉 风险指标
────────────────────────────────
最大回撤:     -1.2%
夏普比率:     2.8
在险价值(VaR): $156 (95% 置信度)

════════════════════════════════════════
```

---

### UC07: 策略回测
**角色**: 进阶用户
**前置条件**: 有历史数据
**主流程**:
1. 用户选择策略参数
2. 用户选择回测时间范围
3. 系统加载历史数据
4. 系统模拟策略执行
5. 系统展示回测结果

**回测结果**:
```
🔬 回测结果 - 平衡策略
────────────────────────────────
回测周期: 2024-07-01 至 2024-12-31
初始资金: $10,000

📈 收益表现
总收益率:    +18.5%
年化收益率:  +37.0%
最大回撤:    -5.2%
夏普比率:    2.1

📊 交易统计
总交易次数:  24
存入次数:    14
提取次数:    10
平均持仓:    4.2 池

💡 优化建议
- 考虑提高 min_apy 到 15%
- 可适当增加单池上限到 35%
────────────────────────────────
```

---

### UC08: 多钱包管理
**角色**: 机构用户
**前置条件**: 配置多个钱包
**主流程**:
1. 用户添加多个钱包地址
2. 系统分别追踪每个钱包
3. 用户设置不同策略
4. 系统独立执行

**界面示例**:
```
👛 钱包管理
────────────────────────────────
钱包 A (主力)
  地址: 0x1234...abcd
  策略: 平衡型
  仓位: $50,000
  收益: +2.1%

钱包 B (激进)
  地址: 0x5678...efgh
  策略: 高收益型
  仓位: $10,000
  收益: +3.5%

总资产: $60,000
综合收益: +2.3%
────────────────────────────────
```

---

## 详细场景

### 场景 1: 新手首次使用

**背景**: 小明第一次使用机器人

**步骤**:
1. 小明安装机器人 `pip install gmx-market-maker`
2. 配置钱包私钥 `export PRIVATE_KEY=xxx`
3. 运行初始化向导 `gmx-mm init`
4. 选择风险偏好: "稳健型"
5. 输入投资金额: $500
6. 确认投资计划
7. 等待交易完成
8. 查看 Dashboard 确认持仓

**预期结果**: 小明成功投入 $500 到 2-3 个池子

---

### 场景 2: 市场剧烈波动

**背景**: BTC 价格 1 小时内下跌 15%

**系统行为**:
1. 监控模块检测到价格异常
2. 触发风险告警
3. 评估 BTC 相关池子影响
4. 如果止损未触发，持续监控
5. 如果触发止损，执行紧急退出

**用户体验**: 收到 Telegram 告警，可选择干预或观望

---

### 场景 3: APY 大幅变化

**背景**: ARB-USDC 池 APY 从 25% 降到 12%

**系统行为**:
1. 定期检查发现 APY 下降 >5%
2. 重新计算池子评分
3. 生成调仓信号: 减少 ARB-USDC 仓位
4. 执行或等待确认

---

### 场景 4: 用户自定义策略

**背景**: 阿辉想要自定义策略参数

**步骤**:
1. 编辑配置文件 `config/config.yaml`
2. 调整参数:
   - `min_apy: 20`
   - `max_single_pool_pct: 40`
   - `whitelist: [ETH-USDC, BTC-USDC]`
3. 重启机器人
4. 验证新策略生效

---

## 用户旅程

### 旅程: 从零开始的 DeFi 收益之路

```
第一天                 第一周                 第一个月               持续优化
   │                     │                      │                     │
   ▼                     ▼                      ▼                     ▼
┌──────────┐        ┌──────────┐          ┌──────────┐          ┌──────────┐
│  安装    │   →    │  投资    │    →     │  监控    │    →     │  优化    │
│  配置    │        │  观察    │          │  调整    │          │  扩展    │
└──────────┘        └──────────┘          └──────────┘          └──────────┘
     │                   │                     │                     │
     │                   │                     │                     │
     ▼                   ▼                     ▼                     ▼
 • 安装依赖           • 一键投资            • 查看报告            • 调整参数
 • 配置钱包           • 理解池子            • 处理告警            • 多钱包管理
 • 选择策略           • 学习风险            • 手动调仓            • API 集成
```

---

## 非功能性需求

### 性能要求
- 数据刷新延迟 < 30秒
- 交易执行时间 < 2分钟
- 支持同时管理 10+ 个池子

### 安全要求
- 私钥仅本地存储
- 支持硬件钱包
- 交易金额限制保护

### 可用性要求
- 99.5% 可用性
- 优雅降级处理 RPC 故障
- 自动重试机制

### 可观测性
- 完整的操作日志
- 性能指标监控
- 错误追踪和告警
